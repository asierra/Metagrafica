#include "text.h"
#include "Display.h"

FontMetricsMap serif_metrics_map = {
    {32, 250},  {33, 333},  {34, 408},  {35, 500},  {36, 500},  {37, 833},
    {38, 778},  {39, 333},  {40, 333},  {41, 333},  {42, 500},  {43, 564},
    {44, 250},  {45, 564},  {46, 250},  {47, 278},  {48, 500},  {49, 500},
    {50, 500},  {51, 500},  {52, 500},  {53, 500},  {54, 500},  {55, 500},
    {56, 500},  {57, 500},  {58, 278},  {59, 278},  {60, 564},  {61, 564},
    {62, 564},  {63, 444},  {64, 921},  {65, 722},  {66, 667},  {67, 667},
    {68, 722},  {69, 611},  {70, 556},  {71, 722},  {72, 722},  {73, 333},
    {74, 389},  {75, 722},  {76, 611},  {77, 889},  {78, 722},  {79, 722},
    {80, 556},  {81, 722},  {82, 667},  {83, 556},  {84, 611},  {85, 722},
    {86, 722},  {87, 944},  {88, 722},  {89, 722},  {90, 611},  {91, 333},
    {92, 278},  {93, 333},  {94, 469},  {95, 500},  {96, 333},  {97, 444},
    {98, 500},  {99, 444},  {100, 500}, {101, 444}, {102, 333}, {103, 500},
    {104, 500}, {105, 278}, {106, 278}, {107, 500}, {108, 278}, {109, 778},
    {110, 500}, {111, 500}, {112, 500}, {113, 500}, {114, 333}, {115, 389},
    {116, 278}, {117, 500}, {118, 500}, {119, 722}, {120, 500}, {121, 500},
    {122, 444}, {123, 480}, {124, 200}, {125, 480}, {126, 541}, {144, 278},
    {145, 333}, {146, 333}, {147, 333}, {148, 333}, {149, 333}, {150, 333},
    {151, 333}, {152, 333}, {154, 333}, {155, 333}, {157, 333}, {158, 333},
    {159, 333}, {160, 250}, {161, 333}, {162, 500}, {163, 500}, {164, 500},
    {165, 500}, {166, 200}, {167, 500}, {168, 333}, {169, 760}, {170, 276},
    {171, 500}, {172, 564}, {173, 333}, {174, 760}, {175, 333}, {176, 400},
    {177, 564}, {178, 300}, {179, 300}, {180, 333}, {181, 500}, {182, 453},
    {183, 250}, {184, 333}, {185, 300}, {186, 310}, {187, 500}, {188, 750},
    {189, 750}, {190, 750}, {191, 444}, {192, 722}, {193, 722}, {194, 722},
    {195, 722}, {196, 722}, {197, 722}, {198, 889}, {199, 667}, {200, 611},
    {201, 611}, {202, 611}, {203, 611}, {204, 333}, {205, 333}, {206, 333},
    {207, 333}, {208, 722}, {209, 722}, {210, 722}, {211, 722}, {212, 722},
    {213, 722}, {214, 722}, {215, 564}, {216, 722}, {217, 722}, {218, 722},
    {219, 722}, {220, 722}, {221, 722}, {222, 556}, {223, 500}, {224, 444},
    {225, 444}, {226, 444}, {227, 444}, {228, 444}, {229, 444}, {230, 667},
    {231, 444}, {232, 444}, {233, 444}, {234, 444}, {235, 444}, {236, 278},
    {237, 278}, {238, 278}, {239, 278}, {240, 500}, {241, 500}, {242, 500},
    {243, 500}, {244, 500}, {245, 500}, {246, 500}, {247, 564}, {248, 500},
    {249, 500}, {250, 500}, {251, 500}, {252, 500}, {253, 500}, {254, 500},
    {255, 500}};

FontMetricsMap serifitalic_metrics_map = {
    {32, 250},  {33, 333},  {34, 420},  {35, 500},  {36, 500},  {37, 833},
    {38, 778},  {39, 333},  {40, 333},  {41, 333},  {42, 500},  {43, 675},
    {44, 250},  {45, 675},  {46, 250},  {47, 278},  {48, 500},  {49, 500},
    {50, 500},  {51, 500},  {52, 500},  {53, 500},  {54, 500},  {55, 500},
    {56, 500},  {57, 500},  {58, 333},  {59, 333},  {60, 675},  {61, 675},
    {62, 675},  {63, 500},  {64, 920},  {65, 611},  {66, 611},  {67, 667},
    {68, 722},  {69, 611},  {70, 611},  {71, 722},  {72, 722},  {73, 333},
    {74, 444},  {75, 667},  {76, 556},  {77, 833},  {78, 667},  {79, 722},
    {80, 611},  {81, 722},  {82, 611},  {83, 500},  {84, 556},  {85, 722},
    {86, 611},  {87, 833},  {88, 611},  {89, 556},  {90, 556},  {91, 389},
    {92, 278},  {93, 389},  {94, 422},  {95, 500},  {96, 333},  {97, 500},
    {98, 500},  {99, 444},  {100, 500}, {101, 444}, {102, 278}, {103, 500},
    {104, 500}, {105, 278}, {106, 278}, {107, 444}, {108, 278}, {109, 722},
    {110, 500}, {111, 500}, {112, 500}, {113, 500}, {114, 389}, {115, 389},
    {116, 278}, {117, 500}, {118, 444}, {119, 667}, {120, 444}, {121, 444},
    {122, 389}, {123, 400}, {124, 275}, {125, 400}, {126, 541}, {144, 278},
    {145, 333}, {146, 333}, {147, 333}, {148, 333}, {149, 333}, {150, 333},
    {151, 333}, {152, 333}, {154, 333}, {155, 333}, {157, 333}, {158, 333},
    {159, 333}, {160, 250}, {161, 389}, {162, 500}, {163, 500}, {164, 500},
    {165, 500}, {166, 275}, {167, 500}, {168, 333}, {169, 760}, {170, 276},
    {171, 500}, {172, 675}, {173, 333}, {174, 760}, {175, 333}, {176, 400},
    {177, 675}, {178, 300}, {179, 300}, {180, 333}, {181, 500}, {182, 523},
    {183, 250}, {184, 333}, {185, 300}, {186, 310}, {187, 500}, {188, 750},
    {189, 750}, {190, 750}, {191, 500}, {192, 611}, {193, 611}, {194, 611},
    {195, 611}, {196, 611}, {197, 611}, {198, 889}, {199, 667}, {200, 611},
    {201, 611}, {202, 611}, {203, 611}, {204, 333}, {205, 333}, {206, 333},
    {207, 333}, {208, 722}, {209, 667}, {210, 722}, {211, 722}, {212, 722},
    {213, 722}, {214, 722}, {215, 675}, {216, 722}, {217, 722}, {218, 722},
    {219, 722}, {220, 722}, {221, 556}, {222, 611}, {223, 500}, {224, 500},
    {225, 500}, {226, 500}, {227, 500}, {228, 500}, {229, 500}, {230, 667},
    {231, 444}, {232, 444}, {233, 444}, {234, 444}, {235, 444}, {236, 278},
    {237, 278}, {238, 278}, {239, 278}, {240, 500}, {241, 500}, {242, 500},
    {243, 500}, {244, 500}, {245, 500}, {246, 500}, {247, 675}, {248, 500},
    {249, 500}, {250, 500}, {251, 500}, {252, 500}, {253, 444}, {254, 500},
    {255, 444},
};

FontMetricsMap serifbold_metrics_map = {
    {32, 250},  {33, 333},  {34, 555},  {35, 500},   {36, 500},  {37, 1000},
    {38, 833},  {39, 333},  {40, 333},  {41, 333},   {42, 500},  {43, 570},
    {44, 250},  {45, 570},  {46, 250},  {47, 278},   {48, 500},  {49, 500},
    {50, 500},  {51, 500},  {52, 500},  {53, 500},   {54, 500},  {55, 500},
    {56, 500},  {57, 500},  {58, 333},  {59, 333},   {60, 570},  {61, 570},
    {62, 570},  {63, 500},  {64, 930},  {65, 722},   {66, 667},  {67, 722},
    {68, 722},  {69, 667},  {70, 611},  {71, 778},   {72, 778},  {73, 389},
    {74, 500},  {75, 778},  {76, 667},  {77, 944},   {78, 722},  {79, 778},
    {80, 611},  {81, 778},  {82, 722},  {83, 556},   {84, 667},  {85, 722},
    {86, 722},  {87, 1000}, {88, 722},  {89, 722},   {90, 667},  {91, 333},
    {92, 278},  {93, 333},  {94, 581},  {95, 500},   {96, 333},  {97, 500},
    {98, 556},  {99, 444},  {100, 556}, {101, 444},  {102, 333}, {103, 500},
    {104, 556}, {105, 278}, {106, 333}, {107, 556},  {108, 278}, {109, 833},
    {110, 556}, {111, 500}, {112, 556}, {113, 556},  {114, 444}, {115, 389},
    {116, 333}, {117, 556}, {118, 500}, {119, 722},  {120, 500}, {121, 500},
    {122, 444}, {123, 394}, {124, 220}, {125, 394},  {126, 520}, {144, 278},
    {145, 333}, {146, 333}, {147, 333}, {148, 333},  {149, 333}, {150, 333},
    {151, 333}, {152, 333}, {154, 333}, {155, 333},  {157, 333}, {158, 333},
    {159, 333}, {160, 250}, {161, 333}, {162, 500},  {163, 500}, {164, 500},
    {165, 500}, {166, 220}, {167, 500}, {168, 333},  {169, 747}, {170, 300},
    {171, 500}, {172, 570}, {173, 333}, {174, 747},  {175, 333}, {176, 400},
    {177, 570}, {178, 300}, {179, 300}, {180, 333},  {181, 556}, {182, 540},
    {183, 250}, {184, 333}, {185, 300}, {186, 330},  {187, 500}, {188, 750},
    {189, 750}, {190, 750}, {191, 500}, {192, 722},  {193, 722}, {194, 722},
    {195, 722}, {196, 722}, {197, 722}, {198, 1000}, {199, 722}, {200, 667},
    {201, 667}, {202, 667}, {203, 667}, {204, 389},  {205, 389}, {206, 389},
    {207, 389}, {208, 722}, {209, 722}, {210, 778},  {211, 778}, {212, 778},
    {213, 778}, {214, 778}, {215, 570}, {216, 778},  {217, 722}, {218, 722},
    {219, 722}, {220, 722}, {221, 722}, {222, 611},  {223, 556}, {224, 500},
    {225, 500}, {226, 500}, {227, 500}, {228, 500},  {229, 500}, {230, 722},
    {231, 444}, {232, 444}, {233, 444}, {234, 444},  {235, 444}, {236, 278},
    {237, 278}, {238, 278}, {239, 278}, {240, 500},  {241, 556}, {242, 500},
    {243, 500}, {244, 500}, {245, 500}, {246, 500},  {247, 570}, {248, 500},
    {249, 556}, {250, 556}, {251, 556}, {252, 556},  {253, 500}, {254, 556},
    {255, 500},
};

FontMetricsMap serifitalicbold_metrics_map = {
    {32, 250},  {33, 389},  {34, 555},  {35, 500},  {36, 500},  {37, 833},
    {38, 778},  {39, 333},  {40, 333},  {41, 333},  {42, 500},  {43, 570},
    {44, 250},  {45, 606},  {46, 250},  {47, 278},  {48, 500},  {49, 500},
    {50, 500},  {51, 500},  {52, 500},  {53, 500},  {54, 500},  {55, 500},
    {56, 500},  {57, 500},  {58, 333},  {59, 333},  {60, 570},  {61, 570},
    {62, 570},  {63, 500},  {64, 832},  {65, 667},  {66, 667},  {67, 667},
    {68, 722},  {69, 667},  {70, 667},  {71, 722},  {72, 778},  {73, 389},
    {74, 500},  {75, 667},  {76, 611},  {77, 889},  {78, 722},  {79, 722},
    {80, 611},  {81, 722},  {82, 667},  {83, 556},  {84, 611},  {85, 722},
    {86, 667},  {87, 889},  {88, 667},  {89, 611},  {90, 611},  {91, 333},
    {92, 278},  {93, 333},  {94, 570},  {95, 500},  {96, 333},  {97, 500},
    {98, 500},  {99, 444},  {100, 500}, {101, 444}, {102, 333}, {103, 500},
    {104, 556}, {105, 278}, {106, 278}, {107, 500}, {108, 278}, {109, 778},
    {110, 556}, {111, 500}, {112, 500}, {113, 500}, {114, 389}, {115, 389},
    {116, 278}, {117, 556}, {118, 444}, {119, 667}, {120, 500}, {121, 444},
    {122, 389}, {123, 348}, {124, 220}, {125, 348}, {126, 570}, {144, 278},
    {145, 333}, {146, 333}, {147, 333}, {148, 333}, {149, 333}, {150, 333},
    {151, 333}, {152, 333}, {154, 333}, {155, 333}, {157, 333}, {158, 333},
    {159, 333}, {160, 250}, {161, 389}, {162, 500}, {163, 500}, {164, 500},
    {165, 500}, {166, 220}, {167, 500}, {168, 333}, {169, 747}, {170, 266},
    {171, 500}, {172, 606}, {173, 333}, {174, 747}, {175, 333}, {176, 400},
    {177, 570}, {178, 300}, {179, 300}, {180, 333}, {181, 576}, {182, 500},
    {183, 250}, {184, 333}, {185, 300}, {186, 300}, {187, 500}, {188, 750},
    {189, 750}, {190, 750}, {191, 500}, {192, 667}, {193, 667}, {194, 667},
    {195, 667}, {196, 667}, {197, 667}, {198, 944}, {199, 667}, {200, 667},
    {201, 667}, {202, 667}, {203, 667}, {204, 389}, {205, 389}, {206, 389},
    {207, 389}, {208, 722}, {209, 722}, {210, 722}, {211, 722}, {212, 722},
    {213, 722}, {214, 722}, {215, 570}, {216, 722}, {217, 722}, {218, 722},
    {219, 722}, {220, 722}, {221, 611}, {222, 611}, {223, 500}, {224, 500},
    {225, 500}, {226, 500}, {227, 500}, {228, 500}, {229, 500}, {230, 722},
    {231, 444}, {232, 444}, {233, 444}, {234, 444}, {235, 444}, {236, 278},
    {237, 278}, {238, 278}, {239, 278}, {240, 500}, {241, 556}, {242, 500},
    {243, 500}, {244, 500}, {245, 500}, {246, 500}, {247, 570}, {248, 500},
    {249, 556}, {250, 556}, {251, 556}, {252, 556}, {253, 444}, {254, 500},
    {255, 444},
};

FontMetricsMap sanserif_metrics_map = {
    {32, 278},  {33, 278},  {34, 355},  {35, 556},   {36, 556},  {37, 889},
    {38, 667},  {39, 222},  {40, 333},  {41, 333},   {42, 389},  {43, 584},
    {44, 278},  {45, 584},  {46, 278},  {47, 278},   {48, 556},  {49, 556},
    {50, 556},  {51, 556},  {52, 556},  {53, 556},   {54, 556},  {55, 556},
    {56, 556},  {57, 556},  {58, 278},  {59, 278},   {60, 584},  {61, 584},
    {62, 584},  {63, 556},  {64, 1015}, {65, 667},   {66, 667},  {67, 722},
    {68, 722},  {69, 667},  {70, 611},  {71, 778},   {72, 722},  {73, 278},
    {74, 500},  {75, 667},  {76, 556},  {77, 833},   {78, 722},  {79, 778},
    {80, 667},  {81, 778},  {82, 722},  {83, 667},   {84, 611},  {85, 722},
    {86, 667},  {87, 944},  {88, 667},  {89, 667},   {90, 611},  {91, 278},
    {92, 278},  {93, 278},  {94, 469},  {95, 556},   {96, 222},  {97, 556},
    {98, 556},  {99, 500},  {100, 556}, {101, 556},  {102, 278}, {103, 556},
    {104, 556}, {105, 222}, {106, 222}, {107, 500},  {108, 222}, {109, 833},
    {110, 556}, {111, 556}, {112, 556}, {113, 556},  {114, 333}, {115, 500},
    {116, 278}, {117, 556}, {118, 500}, {119, 722},  {120, 500}, {121, 500},
    {122, 500}, {123, 334}, {124, 260}, {125, 334},  {126, 584}, {144, 278},
    {145, 333}, {146, 333}, {147, 333}, {148, 333},  {149, 333}, {150, 333},
    {151, 333}, {152, 333}, {154, 333}, {155, 333},  {157, 333}, {158, 333},
    {159, 333}, {160, 278}, {161, 333}, {162, 556},  {163, 556}, {164, 556},
    {165, 556}, {166, 260}, {167, 556}, {168, 333},  {169, 737}, {170, 370},
    {171, 556}, {172, 584}, {173, 333}, {174, 737},  {175, 333}, {176, 400},
    {177, 584}, {178, 333}, {179, 333}, {180, 333},  {181, 556}, {182, 537},
    {183, 278}, {184, 333}, {185, 333}, {186, 365},  {187, 556}, {188, 834},
    {189, 834}, {190, 834}, {191, 611}, {192, 667},  {193, 667}, {194, 667},
    {195, 667}, {196, 667}, {197, 667}, {198, 1000}, {199, 722}, {200, 667},
    {201, 667}, {202, 667}, {203, 667}, {204, 278},  {205, 278}, {206, 278},
    {207, 278}, {208, 722}, {209, 722}, {210, 778},  {211, 778}, {212, 778},
    {213, 778}, {214, 778}, {215, 584}, {216, 778},  {217, 722}, {218, 722},
    {219, 722}, {220, 722}, {221, 667}, {222, 667},  {223, 611}, {224, 556},
    {225, 556}, {226, 556}, {227, 556}, {228, 556},  {229, 556}, {230, 889},
    {231, 500}, {232, 556}, {233, 556}, {234, 556},  {235, 556}, {236, 278},
    {237, 278}, {238, 278}, {239, 278}, {240, 556},  {241, 556}, {242, 556},
    {243, 556}, {244, 556}, {245, 556}, {246, 556},  {247, 584}, {248, 611},
    {249, 556}, {250, 556}, {251, 556}, {252, 556},  {253, 500}, {254, 556},
    {255, 500},
};

FontMetricsMap sanserifitalic_metrics_map = {
    {32, 278},  {33, 278},  {34, 355},  {35, 556},   {36, 556},  {37, 889},
    {38, 667},  {39, 222},  {40, 333},  {41, 333},   {42, 389},  {43, 584},
    {44, 278},  {45, 584},  {46, 278},  {47, 278},   {48, 556},  {49, 556},
    {50, 556},  {51, 556},  {52, 556},  {53, 556},   {54, 556},  {55, 556},
    {56, 556},  {57, 556},  {58, 278},  {59, 278},   {60, 584},  {61, 584},
    {62, 584},  {63, 556},  {64, 1015}, {65, 667},   {66, 667},  {67, 722},
    {68, 722},  {69, 667},  {70, 611},  {71, 778},   {72, 722},  {73, 278},
    {74, 500},  {75, 667},  {76, 556},  {77, 833},   {78, 722},  {79, 778},
    {80, 667},  {81, 778},  {82, 722},  {83, 667},   {84, 611},  {85, 722},
    {86, 667},  {87, 944},  {88, 667},  {89, 667},   {90, 611},  {91, 278},
    {92, 278},  {93, 278},  {94, 469},  {95, 556},   {96, 222},  {97, 556},
    {98, 556},  {99, 500},  {100, 556}, {101, 556},  {102, 278}, {103, 556},
    {104, 556}, {105, 222}, {106, 222}, {107, 500},  {108, 222}, {109, 833},
    {110, 556}, {111, 556}, {112, 556}, {113, 556},  {114, 333}, {115, 500},
    {116, 278}, {117, 556}, {118, 500}, {119, 722},  {120, 500}, {121, 500},
    {122, 500}, {123, 334}, {124, 260}, {125, 334},  {126, 584}, {144, 278},
    {145, 333}, {146, 333}, {147, 333}, {148, 333},  {149, 333}, {150, 333},
    {151, 333}, {152, 333}, {154, 333}, {155, 333},  {157, 333}, {158, 333},
    {159, 333}, {160, 278}, {161, 333}, {162, 556},  {163, 556}, {164, 556},
    {165, 556}, {166, 260}, {167, 556}, {168, 333},  {169, 737}, {170, 370},
    {171, 556}, {172, 584}, {173, 333}, {174, 737},  {175, 333}, {176, 400},
    {177, 584}, {178, 333}, {179, 333}, {180, 333},  {181, 556}, {182, 537},
    {183, 278}, {184, 333}, {185, 333}, {186, 365},  {187, 556}, {188, 834},
    {189, 834}, {190, 834}, {191, 611}, {192, 667},  {193, 667}, {194, 667},
    {195, 667}, {196, 667}, {197, 667}, {198, 1000}, {199, 722}, {200, 667},
    {201, 667}, {202, 667}, {203, 667}, {204, 278},  {205, 278}, {206, 278},
    {207, 278}, {208, 722}, {209, 722}, {210, 778},  {211, 778}, {212, 778},
    {213, 778}, {214, 778}, {215, 584}, {216, 778},  {217, 722}, {218, 722},
    {219, 722}, {220, 722}, {221, 667}, {222, 667},  {223, 611}, {224, 556},
    {225, 556}, {226, 556}, {227, 556}, {228, 556},  {229, 556}, {230, 889},
    {231, 500}, {232, 556}, {233, 556}, {234, 556},  {235, 556}, {236, 278},
    {237, 278}, {238, 278}, {239, 278}, {240, 556},  {241, 556}, {242, 556},
    {243, 556}, {244, 556}, {245, 556}, {246, 556},  {247, 584}, {248, 611},
    {249, 556}, {250, 556}, {251, 556}, {252, 556},  {253, 500}, {254, 556},
    {255, 500},
};

FontMetricsMap sanserifbold_metrics_map = {
    {32, 278},  {33, 333},  {34, 474},  {35, 556},   {36, 556},  {37, 889},
    {38, 722},  {39, 278},  {40, 333},  {41, 333},   {42, 389},  {43, 584},
    {44, 278},  {45, 584},  {46, 278},  {47, 278},   {48, 556},  {49, 556},
    {50, 556},  {51, 556},  {52, 556},  {53, 556},   {54, 556},  {55, 556},
    {56, 556},  {57, 556},  {58, 333},  {59, 333},   {60, 584},  {61, 584},
    {62, 584},  {63, 611},  {64, 975},  {65, 722},   {66, 722},  {67, 722},
    {68, 722},  {69, 667},  {70, 611},  {71, 778},   {72, 722},  {73, 278},
    {74, 556},  {75, 722},  {76, 611},  {77, 833},   {78, 722},  {79, 778},
    {80, 667},  {81, 778},  {82, 722},  {83, 667},   {84, 611},  {85, 722},
    {86, 667},  {87, 944},  {88, 667},  {89, 667},   {90, 611},  {91, 333},
    {92, 278},  {93, 333},  {94, 584},  {95, 556},   {96, 278},  {97, 556},
    {98, 611},  {99, 556},  {100, 611}, {101, 556},  {102, 333}, {103, 611},
    {104, 611}, {105, 278}, {106, 278}, {107, 556},  {108, 278}, {109, 889},
    {110, 611}, {111, 611}, {112, 611}, {113, 611},  {114, 389}, {115, 556},
    {116, 333}, {117, 611}, {118, 556}, {119, 778},  {120, 556}, {121, 556},
    {122, 500}, {123, 389}, {124, 280}, {125, 389},  {126, 584}, {144, 278},
    {145, 333}, {146, 333}, {147, 333}, {148, 333},  {149, 333}, {150, 333},
    {151, 333}, {152, 333}, {154, 333}, {155, 333},  {157, 333}, {158, 333},
    {159, 333}, {160, 278}, {161, 333}, {162, 556},  {163, 556}, {164, 556},
    {165, 556}, {166, 280}, {167, 556}, {168, 333},  {169, 737}, {170, 370},
    {171, 556}, {172, 584}, {173, 333}, {174, 737},  {175, 333}, {176, 400},
    {177, 584}, {178, 333}, {179, 333}, {180, 333},  {181, 611}, {182, 556},
    {183, 278}, {184, 333}, {185, 333}, {186, 365},  {187, 556}, {188, 834},
    {189, 834}, {190, 834}, {191, 611}, {192, 722},  {193, 722}, {194, 722},
    {195, 722}, {196, 722}, {197, 722}, {198, 1000}, {199, 722}, {200, 667},
    {201, 667}, {202, 667}, {203, 667}, {204, 278},  {205, 278}, {206, 278},
    {207, 278}, {208, 722}, {209, 722}, {210, 778},  {211, 778}, {212, 778},
    {213, 778}, {214, 778}, {215, 584}, {216, 778},  {217, 722}, {218, 722},
    {219, 722}, {220, 722}, {221, 667}, {222, 667},  {223, 611}, {224, 556},
    {225, 556}, {226, 556}, {227, 556}, {228, 556},  {229, 556}, {230, 889},
    {231, 556}, {232, 556}, {233, 556}, {234, 556},  {235, 556}, {236, 278},
    {237, 278}, {238, 278}, {239, 278}, {240, 611},  {241, 611}, {242, 611},
    {243, 611}, {244, 611}, {245, 611}, {246, 611},  {247, 584}, {248, 611},
    {249, 611}, {250, 611}, {251, 611}, {252, 611},  {253, 556}, {254, 611},
    {255, 556},
};

FontMetricsMap sanserifitalicbold_metrics_map = {
    {32, 278},  {33, 333},  {34, 474},  {35, 556},   {36, 556},  {37, 889},
    {38, 722},  {39, 278},  {40, 333},  {41, 333},   {42, 389},  {43, 584},
    {44, 278},  {45, 584},  {46, 278},  {47, 278},   {48, 556},  {49, 556},
    {50, 556},  {51, 556},  {52, 556},  {53, 556},   {54, 556},  {55, 556},
    {56, 556},  {57, 556},  {58, 333},  {59, 333},   {60, 584},  {61, 584},
    {62, 584},  {63, 611},  {64, 975},  {65, 722},   {66, 722},  {67, 722},
    {68, 722},  {69, 667},  {70, 611},  {71, 778},   {72, 722},  {73, 278},
    {74, 556},  {75, 722},  {76, 611},  {77, 833},   {78, 722},  {79, 778},
    {80, 667},  {81, 778},  {82, 722},  {83, 667},   {84, 611},  {85, 722},
    {86, 667},  {87, 944},  {88, 667},  {89, 667},   {90, 611},  {91, 333},
    {92, 278},  {93, 333},  {94, 584},  {95, 556},   {96, 278},  {97, 556},
    {98, 611},  {99, 556},  {100, 611}, {101, 556},  {102, 333}, {103, 611},
    {104, 611}, {105, 278}, {106, 278}, {107, 556},  {108, 278}, {109, 889},
    {110, 611}, {111, 611}, {112, 611}, {113, 611},  {114, 389}, {115, 556},
    {116, 333}, {117, 611}, {118, 556}, {119, 778},  {120, 556}, {121, 556},
    {122, 500}, {123, 389}, {124, 280}, {125, 389},  {126, 584}, {144, 278},
    {145, 333}, {146, 333}, {147, 333}, {148, 333},  {149, 333}, {150, 333},
    {151, 333}, {152, 333}, {154, 333}, {155, 333},  {157, 333}, {158, 333},
    {159, 333}, {160, 278}, {161, 333}, {162, 556},  {163, 556}, {164, 556},
    {165, 556}, {166, 280}, {167, 556}, {168, 333},  {169, 737}, {170, 370},
    {171, 556}, {172, 584}, {173, 333}, {174, 737},  {175, 333}, {176, 400},
    {177, 584}, {178, 333}, {179, 333}, {180, 333},  {181, 611}, {182, 556},
    {183, 278}, {184, 333}, {185, 333}, {186, 365},  {187, 556}, {188, 834},
    {189, 834}, {190, 834}, {191, 611}, {192, 722},  {193, 722}, {194, 722},
    {195, 722}, {196, 722}, {197, 722}, {198, 1000}, {199, 722}, {200, 667},
    {201, 667}, {202, 667}, {203, 667}, {204, 278},  {205, 278}, {206, 278},
    {207, 278}, {208, 722}, {209, 722}, {210, 778},  {211, 778}, {212, 778},
    {213, 778}, {214, 778}, {215, 584}, {216, 778},  {217, 722}, {218, 722},
    {219, 722}, {220, 722}, {221, 667}, {222, 667},  {223, 611}, {224, 556},
    {225, 556}, {226, 556}, {227, 556}, {228, 556},  {229, 556}, {230, 889},
    {231, 556}, {232, 556}, {233, 556}, {234, 556},  {235, 556}, {236, 278},
    {237, 278}, {238, 278}, {239, 278}, {240, 611},  {241, 611}, {242, 611},
    {243, 611}, {244, 611}, {245, 611}, {246, 611},  {247, 584}, {248, 611},
    {249, 611}, {250, 611}, {251, 611}, {252, 611},  {253, 556}, {254, 611},
    {255, 556},
};

FontMetricsMap symbol_metrics_map = {
    {32, 250},  {33, 333},  {34, 713},  {35, 500},   {36, 549},   {37, 833},
    {38, 778},  {39, 439},  {40, 333},  {41, 333},   {42, 500},   {43, 549},
    {44, 250},  {45, 549},  {46, 250},  {47, 278},   {48, 500},   {49, 500},
    {50, 500},  {51, 500},  {52, 500},  {53, 500},   {54, 500},   {55, 500},
    {56, 500},  {57, 500},  {58, 278},  {59, 278},   {60, 549},   {61, 549},
    {62, 549},  {63, 444},  {64, 549},  {65, 722},   {66, 667},   {67, 722},
    {68, 612},  {69, 611},  {70, 763},  {71, 603},   {72, 722},   {73, 333},
    {74, 631},  {75, 722},  {76, 686},  {77, 889},   {78, 722},   {79, 722},
    {80, 768},  {81, 741},  {82, 556},  {83, 592},   {84, 611},   {85, 690},
    {86, 439},  {87, 768},  {88, 645},  {89, 795},   {90, 611},   {91, 333},
    {92, 863},  {93, 333},  {94, 658},  {95, 500},   {96, 500},   {97, 631},
    {98, 549},  {99, 549},  {100, 494}, {101, 439},  {102, 521},  {103, 411},
    {104, 603}, {105, 329}, {106, 603}, {107, 549},  {108, 549},  {109, 576},
    {110, 521}, {111, 549}, {112, 549}, {113, 521},  {114, 549},  {115, 603},
    {116, 439}, {117, 576}, {118, 713}, {119, 686},  {120, 493},  {121, 686},
    {122, 494}, {123, 480}, {124, 200}, {125, 480},  {126, 549},  {160, 750},
    {161, 620}, {162, 247}, {163, 549}, {164, 167},  {165, 713},  {166, 500},
    {167, 753}, {168, 753}, {169, 753}, {170, 753},  {171, 1042}, {172, 987},
    {173, 603}, {174, 987}, {175, 603}, {176, 400},  {177, 549},  {178, 411},
    {179, 549}, {180, 549}, {181, 713}, {182, 494},  {183, 460},  {184, 549},
    {185, 549}, {186, 549}, {187, 549}, {188, 1000}, {189, 603},  {190, 1000},
    {191, 658}, {192, 823}, {193, 686}, {194, 795},  {195, 987},  {196, 768},
    {197, 768}, {198, 823}, {199, 768}, {200, 768},  {201, 713},  {202, 713},
    {203, 713}, {204, 713}, {205, 713}, {206, 713},  {207, 713},  {208, 768},
    {209, 713}, {210, 790}, {211, 790}, {212, 890},  {213, 823},  {214, 549},
    {215, 250}, {216, 713}, {217, 603}, {218, 603},  {219, 1042}, {220, 987},
    {221, 603}, {222, 987}, {223, 603}, {224, 494},  {225, 329},  {226, 790},
    {227, 790}, {228, 786}, {229, 713}, {230, 384},  {231, 384},  {232, 384},
    {233, 384}, {234, 384}, {235, 384}, {236, 494},  {237, 494},  {238, 494},
    {239, 494}, {241, 329}, {242, 274}, {243, 686},  {244, 686},  {245, 686},
    {246, 384}, {247, 384}, {248, 384}, {249, 384},  {250, 384},  {251, 384},
    {252, 494}, {253, 494}, {254, 494},
};

FontMetricsMap cmmi_metrics_map = {
    {32, 0},    {33, 622},  {34, 466},  {35, 591},  {36, 828},  {37, 517},
    {38, 362},  {39, 654},  {40, 1000}, {41, 1000}, {42, 1000}, {43, 1000},
    {44, 277},  {45, 277},  {46, 500},  {47, 500},  {48, 500},  {49, 500},
    {50, 500},  {51, 500},  {52, 500},  {53, 500},  {54, 500},  {55, 500},
    {56, 500},  {57, 500},  {58, 277},  {59, 277},  {60, 777},  {61, 500},
    {62, 777},  {63, 500},  {64, 530},  {65, 750},  {66, 758},  {67, 714},
    {68, 827},  {69, 738},  {70, 643},  {71, 786},  {72, 831},  {73, 439},
    {74, 554},  {75, 849},  {76, 680},  {77, 970},  {78, 803},  {79, 762},
    {80, 642},  {81, 790},  {82, 759},  {83, 613},  {84, 584},  {85, 682},
    {86, 583},  {87, 944},  {88, 828},  {89, 580},  {90, 682},  {91, 388},
    {92, 388},  {93, 388},  {94, 1000}, {95, 1000}, {96, 416},  {97, 528},
    {98, 429},  {99, 432},  {100, 520}, {101, 465}, {102, 489}, {103, 476},
    {104, 576}, {105, 344}, {106, 411}, {107, 520}, {108, 298}, {109, 878},
    {110, 600}, {111, 484}, {112, 503}, {113, 446}, {114, 451}, {115, 468},
    {116, 361}, {117, 572}, {118, 484}, {119, 715}, {120, 571}, {121, 490},
    {122, 465}, {123, 322}, {124, 384}, {125, 636}, {126, 500}, {127, 277},
    {128, 651}, {160, 333}, {161, 615}, {162, 833}, {163, 762}, {164, 694},
    {165, 742}, {166, 831}, {167, 779}, {168, 583}, {169, 666}, {170, 612},
    {173, 772}, {174, 639}, {175, 565}, {176, 517}, {177, 444}, {178, 405},
    {179, 437}, {180, 496}, {181, 469}, {182, 353}, {183, 576}, {184, 583},
    {185, 602}, {186, 493}, {187, 437}, {188, 570}, {189, 517}, {190, 571},
    {191, 437}, {192, 540}, {193, 595}, {194, 625}, {195, 651}, {196, 277},
    {199, 540}};

float text_width(TextState ts, string s) {
  if (ts.font_face==FN_COURIER) 
    return s.length() * 600 * ts.font_size / 1000;

  float width = 0;
  FontMetricsMap fmmap;

  switch (ts.font_face) {
  default:
  case FN_SERIF:
    fmmap = serif_metrics_map;
    break;
  case FN_SERIF_BOLD:
    fmmap = serifbold_metrics_map;
    break;
  case FN_SERIF_ITALIC:
    fmmap = serifitalic_metrics_map;
    break;
  case FN_SYMBOL:
    fmmap = symbol_metrics_map;
    break;
  case FN_TEX_CMMI:
    fmmap = cmmi_metrics_map;
    break;
  case FN_SANSERIF:
    fmmap = sanserif_metrics_map;
    break;
  case FN_SANSERIF_ITALIC:
    fmmap = sanserifitalic_metrics_map;
    break;
  case FN_SANSERIF_ITALIC_BOLD:
  case FN_SANSERIF_BOLD:
    fmmap = sanserifbold_metrics_map;
    break;
  }
  for (auto &ch : s) {
    width += fmmap[ch] * ts.font_size / 1000;
  }
  return width;
}

void Text::draw(Display &g) {
  g.setRelFontSize(textstate.font_size);
  g.setFontFace(textstate.font_face);
  g.text(text);
}

void TextLine::draw(Display &g) {
  float vdesp;

  int text_align = g.getTextAlign();
  if (text_align > 0) {
    int x = width() * g.getFontSize() / (3 - text_align);
    g.rmoveto(-x, 0);
    g.setTextAlign(0);
  }
  for (const auto &text : textline) {
    TextState ts = text->getState();
    //printf("text <%s> state %s\n", text->getText().c_str(), ts.str().c_str());
    if (ts.script != 0) {
      vdesp = (ts.script < 0) ? -g.getFontSize() * 0.14 : g.getFontSize() * 0.56;
      g.rmoveto(0, vdesp);
    }
    text->draw(g);
    if (ts.script != 0) {
      g.rmoveto(0, -vdesp);
    }
  }
  if (text_align > 0)
    g.setTextAlign(text_align);
}

float TextLine::width() {
  float w = 0;
  for (const auto &text : textline) {
    TextState ts = text->getState();
    w += text_width(ts, text->getText());
  }
  return w;
}